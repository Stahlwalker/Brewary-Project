<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>Testing API's</title>

     <style>
       #map {
        height: 400px;
        width: 100%;
       }
    </style>
  
</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col-md-8 col-md-offset-2">
				<form>
					<input type="text" name="beerSearch" id="beerSearch">
					<input type="submit" name="submit" id="submit">
				</form>	
			</div>
		</div>
	</div>

	<div class="container">
		<div class="row">
			<table class="table" id="beer-table">
				<thead>
					<tr>
						<th>Beer Name</th>
						<th>Brewery Name</th>
						<th>ABV</th>
						<th>Style</th>
						<th>Glass style</th>
						
					</tr>
				</thead>

				<tbody id="beer-body"></tbody>
			</table>
		</div>
	</div>	

	<div id="map"></div>				


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

	jQuery.ajaxPrefilter(function(options) {
        if (options.crossDomain && jQuery.support.cors) {
            options.url = 'https://cors-anywhere.herokuapp.com/' + options.url;
        }
    });


	$("#submit").on("click", function(){
		event.preventDefault();

		$("#beer-body").empty();
		clearMarkers();
		deleteMarkers();

		var beer = $("#beerSearch").val().trim();

        var queryURL =  "https://api.brewerydb.com/v2/search?q=" + beer + 
        "&withBreweries=Y&type=beer&key=3be3e987ffecfe82a589838b384c138f&format=json";

        $.ajax({
            url: queryURL,
            method: "GET"
          }).done(function(response) {
            console.log(response);
            var beers = response.data;



            console.log(beers[0].breweries[0].name);
          
            

            for(var i = 0; i < beers.length; i++){
            	//console.log(!beers[i].glass.name.equals("undefined"));
            	if(beers[i].hasOwnProperty('glass') && 
            		beers[i].breweries[0].hasOwnProperty('locations')){
		            	$("#beer-table > tbody").append("<tr><td>" + beers[i].name + "</td><td>" + beers[i].breweries[0].name + "</td><td>" 
		            		+ beers[i].abv + "%</td><td>" + beers[i].style.name + 
		            		 "</td><td>" + beers[i].glass.name + "</td></tr>");



		            	var lat = beers[i].breweries[0].locations[0].latitude;
	            		var lng = beers[i].breweries[0].locations[0].longitude;

	            		var latLng = new google.maps.LatLng(lat, lng);
	            		addMarker(latLng);
					}
        	}
    	});

	}); 

	//api key: AIzaSyBRoBFgQ8l2qx8Q5JVqkyWcqc3SqcGBuBY
    var map;
    var markers = [];

    function addMarker(location) {
        var marker = new google.maps.Marker({
          position: location,
          map: map
        });
        markers.push(marker);
    } 

    function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(map);
        }
    }

    function clearMarkers() {
        setMapOnAll(null);
    }

    function showMarkers() {
        setMapOnAll(map);
    }

    function deleteMarkers() {
        clearMarkers();
        markers = [];
    }


	function initMap() {
	    map = new google.maps.Map(document.getElementById('map'), {
	      zoom: 2,
	      center: new google.maps.LatLng(2.8,-187.3),
	      mapTypeId: 'terrain'
	    });
	}; 
 
            

</script>	

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRoBFgQ8l2qx8Q5JVqkyWcqc3SqcGBuBY&callback=initMap">
</script>

</body>	
</html>

